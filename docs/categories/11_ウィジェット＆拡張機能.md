# ウィジェット&拡張機能分析

**調査日**: 2025年12月25日
**対象**: 30件のウィジェット/拡張機能アプリ

---

## トップアプリ

| スター | アプリ | 種別 | 説明 |
|--------|--------|------|------|
| 3,560 | Hush | コンテンツブロック | ノイズレスブラウジング |
| 1,596 | Adguard | コンテンツブロック | 広告＆トラッキング防止 |
| 795 | BlockParty | コンテンツブロック | 広告ブロック |
| 793 | PiPifier | Safari拡張 | PiPモード |
| 762 | Adblock Fast | コンテンツブロック | 高速広告ブロック |
| 692 | Clendar | ウィジェット | カレンダー |
| 601 | Backyard Birds | ウィジェット | Apple公式サンプル |
| 538 | Contributions | Today | GitHub貢献 |
| 531 | Fojusi | Today | 作業タイマー |
| 364 | Contribution Graphs | ウィジェット | GitHub貢献 |

---

## カテゴリ別詳細

### コンテンツブロッカー

| アプリ | スター | 特徴 |
|--------|--------|------|
| Hush | 3,560 | 軽量、プライバシー重視 |
| Adguard | 1,596 | 高機能、DNS設定 |
| BlockParty | 795 | シンプル |
| Adblock Fast | 762 | パフォーマンス重視 |
| PIA VPN | 333 | VPN統合 |
| Adblock Plus | 148 | 老舗 |
| Blahker | 133 | 台湾サイト特化 |

### Safari拡張

| アプリ | スター | 機能 |
|--------|--------|------|
| PiPifier | 793 | 全HTML5動画をPiP化 |
| Homepage | 63 | 新規タブホームページ設定 |
| Overamped | 46 | AMP無効化 |
| HTTPS4All | 39 | HTTPSリダイレクト |

### ウィジェット（iOS 14+）

| アプリ | スター | 表示内容 |
|--------|--------|----------|
| Clendar | 692 | カレンダー&イベント |
| Backyard Birds | 601 | Apple公式、SwiftData |
| Contribution Graphs | 364 | GitHub貢献 |
| Space! | 113 | NASA天文写真 |
| Word Of The Day | 92 | 今日の単語 |
| XKCDY | 45 | xkcd漫画 |

### Today拡張（レガシー）

| アプリ | スター | 機能 |
|--------|--------|------|
| Contributions | 538 | GitHub貢献グラフ |
| Fojusi | 531 | ポモドーロタイマー |
| News API | 292 | ニュースヘッドライン |
| GitHub contributions | 160 | 貢献グラフ |
| Daylight | 134 | 日光時間 |
| Bus Today | 78 | バス時刻 |
| TimeLines | 67 | 世界時計 |

---

## 実装パターン

### コンテンツブロッカー

```swift
// Content Blocker Extension
class ContentBlockerRequestHandler: NSObject, NSExtensionRequestHandling {
    func beginRequest(with context: NSExtensionContext) {
        let attachment = NSItemProvider(
            contentsOf: Bundle.main.url(
                forResource: "blockerList",
                withExtension: "json"
            )
        )

        let item = NSExtensionItem()
        item.attachments = [attachment]

        context.completeRequest(returningItems: [item])
    }
}
```

**blockerList.json例**:
```json
[
    {
        "trigger": {
            "url-filter": ".*",
            "resource-type": ["script"],
            "load-type": ["third-party"]
        },
        "action": {
            "type": "block"
        }
    }
]
```

### iOS 14+ ウィジェット

```swift
import WidgetKit
import SwiftUI

struct Provider: TimelineProvider {
    func placeholder(in context: Context) -> SimpleEntry {
        SimpleEntry(date: Date(), data: .placeholder)
    }

    func getSnapshot(in context: Context, completion: @escaping (SimpleEntry) -> ()) {
        let entry = SimpleEntry(date: Date(), data: .sample)
        completion(entry)
    }

    func getTimeline(in context: Context, completion: @escaping (Timeline<Entry>) -> ()) {
        Task {
            let data = await fetchData()
            let entry = SimpleEntry(date: Date(), data: data)
            let timeline = Timeline(
                entries: [entry],
                policy: .after(Date().addingTimeInterval(3600))
            )
            completion(timeline)
        }
    }
}

struct MyWidget: Widget {
    var body: some WidgetConfiguration {
        StaticConfiguration(
            kind: "MyWidget",
            provider: Provider()
        ) { entry in
            MyWidgetEntryView(entry: entry)
        }
        .configurationDisplayName("マイウィジェット")
        .description("説明文")
        .supportedFamilies([.systemSmall, .systemMedium, .systemLarge])
    }
}
```

### Safari拡張

```swift
// Safari Web Extension
class SafariWebExtensionHandler: NSObject, NSExtensionRequestHandling {
    func beginRequest(with context: NSExtensionContext) {
        let item = context.inputItems.first as? NSExtensionItem
        let message = item?.userInfo?[SFExtensionMessageKey]

        // メッセージ処理

        let response = NSExtensionItem()
        response.userInfo = [SFExtensionMessageKey: ["response": "ok"]]
        context.completeRequest(returningItems: [response])
    }
}
```

---

## ウィジェットデザインガイド

### サイズ別推奨内容

| サイズ | 推奨内容 | 例 |
|--------|----------|-----|
| Small | 単一データ | 歩数、天気、次のイベント |
| Medium | リスト（2-3項目） | 予定、ニュース |
| Large | 詳細リスト | カレンダー、タスク |
| Extra Large | ダッシュボード | 複合情報 |

### ベストプラクティス

| 項目 | 推奨 |
|------|------|
| 更新頻度 | 必要最小限 |
| タップ領域 | 明確なディープリンク |
| プレースホルダー | 意味のあるスケルトン |
| ダークモード | 完全対応 |
| アクセシビリティ | VoiceOver対応 |

---

## インタラクティブウィジェット（iOS 17+）

```swift
struct ToggleIntent: AppIntent {
    static var title: LocalizedStringResource = "Toggle Item"

    @Parameter(title: "Item ID")
    var itemId: String

    func perform() async throws -> some IntentResult {
        // トグル処理
        return .result()
    }
}

struct InteractiveWidget: Widget {
    var body: some WidgetConfiguration {
        StaticConfiguration(kind: "Interactive", provider: Provider()) { entry in
            VStack {
                Text(entry.title)
                Button(intent: ToggleIntent(itemId: entry.id)) {
                    Image(systemName: entry.isComplete ? "checkmark.circle.fill" : "circle")
                }
            }
        }
    }
}
```

---

## Swiftパッケージ機会

### WidgetBuilderKit

**機能**:
- TimelineProvider簡略化
- 共通レイアウトテンプレート
- ディープリンク生成
- スナップショット処理

**API例**:
```swift
@WidgetTimeline(refreshInterval: .hourly)
var timeline: [MyEntry]

MyWidget {
    WidgetStack {
        WidgetHeader(title: "タイトル")
        WidgetList(items: entries.prefix(3))
    }
}
```

### ContentBlockerBuilder

**機能**:
- ルールビルダーAPI
- ルールテスト
- パフォーマンス分析
- 動的更新

### SafariExtensionKit

**機能**:
- メッセージング簡略化
- コンテンツスクリプト管理
- ストレージ抽象化
- 権限管理

---

## 学習リソース

| アプリ | 学習ポイント |
|--------|-------------|
| Clendar | 完全なウィジェット実装 |
| Backyard Birds | Apple公式、SwiftData連携 |
| Hush | 効率的なコンテンツブロック |
| PiPifier | Safari拡張 |
| Contributions | Today拡張（レガシー） |

---

## 開発上の考慮事項

### パフォーマンス

| 項目 | 対策 |
|------|------|
| メモリ | 16MB制限内に収める |
| CPU | バックグラウンド処理最小化 |
| ネットワーク | キャッシュ活用 |
| バッテリー | 更新頻度最適化 |

### データ共有

| 方法 | 用途 |
|------|------|
| App Groups | ホストアプリとの共有 |
| UserDefaults | 設定保存 |
| Keychain | 機密データ |
| Core Data | 構造化データ |

### テスト

```swift
// ウィジェットプレビュー
#Preview(as: .systemSmall) {
    MyWidget()
} timeline: {
    SimpleEntry(date: .now, data: .sample)
    SimpleEntry(date: .now.addingTimeInterval(3600), data: .updated)
}
```

---

## トレンド

### 成長中
- インタラクティブウィジェット
- Live Activities
- StandBy対応

### 安定
- コンテンツブロッカー
- 情報表示ウィジェット

### 注目
- ControlCenter ウィジェット（iOS 18）
- visionOS ウィジェット
- watchOS複合ウィジェット
